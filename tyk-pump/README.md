## Tyk Pump
Tyk Pump is a pluggable analytics purger to move Analytics generated by your Tyk nodes to any back-end.

[Overview of Tyk Pump](https://tyk.io/docs/tyk-pump/)

[More on pump configurations](https://github.com/TykTechnologies/tyk-pump/blob/master/README.md#pumps--back-ends-supported)

## Introduction
This chart deploys the open source Tyk pump on a [Kubernetes](https://kubernetes.io/) cluster using the [Helm](https://helm.sh/) package manager.

For typical usage, we recommend using following umbrella charts:
* For Tyk Open Source, please use [tyk-oss](https://github.com/TykTechnologies/tyk-charts/tree/main/tyk-oss)
* Coming soon: For Tyk Hybrid Gateway with Tyk Cloud, please use [tyk-hybrid-gateway](https://github.com/TykTechnologies/tyk-charts/tree/main/)
* Coming soon: For Tyk Self-Managed, please use [tyk-self-managed](https://github.com/TykTechnologies/tyk-charts/tree/main/)

[Learn more about different deployment options](https://tyk.io/docs/apim/)

## Prerequisites
* Kuberentes 1.19+
* Helm 3+
* [Redis](https://tyk.io/docs/planning-for-production/redis/)

## Installing the Chart
<!--
To install the chart from the Helm repository in namespace `tyk` with the release name `tyk-pump`:
    helm repo add tyk-helm https://helm.tyk.io/public/helm/charts/
    helm show values tyk-helm/tyk-pump > values-pump.yaml
    helm install tyk-pump tyk-helm/tyk-pump -n tyk --create-namespace -f values-pump.yaml
-->

<!-- To be removed after the chart is published -->
To install the chart from Git repository in namespace `tyk` with the release name `tyk-pump`:

    git clone https://github.com/TykTechnologies/tyk-charts.git
    cd tyk-charts
    helm show values tyk-pump > values.yaml

Note: Set redis connection details first. See [Configuration](#configuration) below.

    helm install tyk-pump tyk-pump -n tyk --create-namespace -f values.yaml

## Uninstalling the Chart

    helm uninstall tyk-pump -n tyk

This removes all the Kubernetes components associated with the chart and deletes the release.

## Upgrading Chart

    helm upgrade tyk-pump tyk-pump -n tyk

### Upgrading from tyk-headless chart
Please see Migration notes in [tyk-oss](https://github.com/TykTechnologies/tyk-charts/tree/main/tyk-oss) chart

## Configuration
See [Customizing the Chart Before Installing](https://helm.sh/docs/intro/using_helm/#customizing-the-chart-before-installing). To get all configurable options with detailed comments:

    helm show values tyk-pump > values.yaml
    
You can update any value in your local values.yaml file and use `-f [filename]` flag to override default values during installation. Alternatively, you can use `--set` flag to set it in Tyk installation.

### Set Redis connection details (Required)
Redis is Tyk Pump's primary database where it scrapes Tyk Gateway analytics from. You may set `global.redis.addr` and `global.redis.pass` with redis connection string and password for Tyk Gateway respectively.

### Pump Configurations
 
#### No Pump
Set `pump.backend=''` if you do not want to persist analytics data or you don't want to send analytics to mongo, postgres or prometheus.

#### Mongo Pump
To view analytics data on Dashboard if your backend is Mongo:
Set `pump.backend='mongo'`, and add connection details for mongo (same as Dashboard configurations) under `global.mongo`.

#### Postgres Pump
To view analytics data on Dashboard if your backend is Postgres:
Set `pump.backend='postgres'`, and add connection details for postgres (same as Dashboard configurations) under `global.postgres`.

#### Prometheus Pump
You can easily enable prometheus pump by setting the `pump.backend` field to `prometheus` in your values.yaml file.

To configure prometheus connection settings, set connection details in `pump.prometheusPump` section.

We also support monitoring using Prometheus Operator. All you have to do is set `pump.prometheusPump.prometheusOperator.enabled` to true.
This will create a PodMonitor resource for your Pump instance.

#### Uptime Pump
Uptime Pump can be configured by setting `pump.uptimePumpBackend` in values.yaml file. It support following values
1. mongo: Used to set mongo pump for uptime analytics.
2. postgres: Used to set postgres pump for uptime analytics.
3. empty: Used to disable uptime analytics.

#### Other Pumps
To setup other backends for pump, refer to this [document](https://github.com/TykTechnologies/tyk-pump/blob/master/README.md#pumps--back-ends-supported) and add the required environment variables in `pump.extraEnvs`


