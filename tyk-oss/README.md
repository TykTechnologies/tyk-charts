## Tyk Open Source

tyk-oss provides the default deployment of the Tyk Open Source stack. It includes the Tyk Gateway, an open source Enterprise API Gateway, 
supporting REST, GraphQL, TCP and gRPC protocols; and Tyk Pump, an analytics purger that moves the data generated by your Tyk nodes to any back-end.

## Introduction

By default, this chart installs following components as subcharts on a [Kubernetes](https://kubernetes.io/) cluster using the [Helm](https://helm.sh/) package manager.
| Component | Enabled by Default | Flag |
| --------- | ------------------ | ---- |
|Tyk Gateway |true  | n/a                    |
|Tyk Pump    |false | global.components.pump |

To enable or disable each component, change the corresponding enabled flag.

## Prerequisites

* Kuberentes 1.19+
* Helm 3+
* [Redis](https://tyk.io/docs/planning-for-production/redis/) should already be installed or accessible by the gateway

## Installing the Chart

To install the chart from Git repository in namespace `tyk` with the release name `tyk-oss`:

    git clone https://github.com/TykTechnologies/tyk-charts.git
    cd tyk-charts
    helm dependency update tyk-oss
    helm show values tyk-oss > values-oss.yaml

Note: Set redis connection details first. See [Configuration](#Configuration) below.

    helm install tyk-oss tyk-oss -n tyk --create-namespace -f values-oss.yaml

## Uninstalling the Chart

```
helm uninstall tyk-oss -n tyk
```
This removes all the Kubernetes components associated with the chart and deletes the release.

## Upgrading Chart

```
helm upgrade tyk-oss tyk-oss -n tyk
```

*Note: Upgrading from tyk-headless chart*

If you were using `tyk-headless` chart for existing release, you cannot upgrade directly. Please modify the `values.yaml` base on your requirements and install using the new `tyk-oss` chart.

## Configuration

To get all configurable options with detailed comments:

    helm show values tyk-oss > values.yaml

You can update any value in your local `values.yaml` file and use `-f [filename]` flag to override default values during installation. 
Alternatively, you can use `--set` flag to set it in Tyk installation.

### Set Redis conenction details (Required)

Tyk uses Redis for distributed rate-limiting and token storage. You may set `global.redis.addr` and `global.redis.pass` with redis connection 
string and password respectively.

If you do not already have redis installed, you may use these charts provided by Bitnami

    helm repo add bitnami https://charts.bitnami.com/bitnami
    helm install tyk-redis bitnami/redis -n tyk --create-namespace

Follow the notes from the installation output to get connection details and password. The DNS name of your Redis as set by Bitnami is 
`tyk-redis-master.tyk.svc.cluster.local:6379` (Tyk needs the name including the port) 

### Pump Configurations

To enable Pump, set `global.components.pump` to true

#### Send analytics data to backend
It is usually used with Dashboard (in licensed edition) to view analytics data. However, for OSS installation, you can also persist analytics 
data in a datastore for your use.

| Pump       | Configuration      |
| ---------- | ------------------ | 
| No Pump    | Set `tyk-pump.pump.backend=''` if you do not want to persist analytics data to backend.  |
| Mongo Pump | Set `tyk-pump.pump.backend='mongo'`, and add connection details for mongo under `global.mongo`. |
| SQL Pump (Default)  | Set `tyk-pump.pump.backend='postgres'`, and add connection details for postgres under `global.postgres`. |


#### Other Pumps
To setup other backends for pump, refer to this [document](https://github.com/TykTechnologies/tyk-pump/blob/master/README.md#pumps--back-ends-supported) and add the required environment variables in `tyk-pump.pump.extraEnvs`

<!--
e.g. Prometheus Pump

```
TYK_PMP_PUMPS_PROMETHEUS_TYPE=prometheus
TYK_PMP_PUMPS_PROMETHEUS_META_ADDR=localhost:9090
TYK_PMP_PUMPS_PROMETHEUS_META_PATH=/metrics
TYK_PMP_PUMPS_PROMETHEUS_META_CUSTOMMETRICS='[{"name":"tyk_http_requests_total","description":"Total of API requests","metric_type":"counter","labels":["response_code","api_name"]}]'
TYK_PMP_PUMPS_PROMETHEUS_META_DISABLED_METRICS=[]
```
-->
